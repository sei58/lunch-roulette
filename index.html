<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>오늘의 점심</title>
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap" rel="stylesheet">
    <style>
        /* 기본 스타일 (PC 화면에 적합한 간격) */
        body {
            margin: 0;
            font-family: 'Gowun Dodum', sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center; /* 중앙 정렬로 변경 */
            align-items: center; /* 가운데 정렬 유지 */
            min-height: 100vh;
            background: linear-gradient(to bottom, #a8d8ff, #ffffff);
            color: #333;
            overflow-x: hidden;
        }

        .container {
            text-align: center;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 25px 40px; /* PC 패딩 조정 */
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 1;
            width: 90%;
            max-width: 500px;
            box-sizing: border-box;
            flex-grow: 0;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            margin-top: 0; /* 중앙 정렬을 위해 마진 제거 */
            margin-bottom: 0; /* 중앙 정렬을 위해 마진 제거 */
        }

        .title {
            font-size: 2.5em;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px; /* PC 마진 조정 */
            display: flex;
            align-items: center;
            justify-content: center;
            white-space: nowrap;
        }

        .title .emoji {
            font-size: 1.2em;
            vertical-align: middle;
            margin: 0 10px;
        }

        .slot-machine {
            width: 100%;
            height: 100px;
            border: 5px solid rgb(190, 214, 0);
            border-radius: 15px;
            background-color: #fff;
            margin: 0 auto 20px; /* PC 마진 조정 */
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
        }

        .slot-content-wrapper {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .slot-item {
            font-size: 1.4em;
            font-weight: bold;
            color: #555;
            height: 100px;
            line-height: 100px;
            width: 100%;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .result-text {
            font-size: 1.5em;
            font-weight: bold;
            color: #666;
            margin-top: 20px; /* PC 마진 조정 */
            min-height: 30px;
        }

        .result-restaurant-name {
            color: rgb(190, 214, 0);
            font-weight: bold;
            display: inline-block;
        }

        .button-container {
            margin-top: 20px; /* PC 마진 조정 */
            display: flex;
            justify-content: center;
            gap: 15px; /* PC 간격 조정 */
            flex-wrap: nowrap;
        }

        .btn {
            background-color: rgb(190, 214, 0);
            color: #fff;
            border: none;
            padding: 12px 20px; /* PC 패딩 조정 */
            border-radius: 10px;
            font-size: 1.1em; /* 폰트 사이즈 살짝 줄임 */
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
        }

        .btn:hover {
            background-color: rgb(160, 180, 0);
        }

        .btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        /* Help Button Styles */
        .help-button {
            position: absolute;
            top: 15px;
            left: 15px;
            width: 35px;
            height: 35px;
            background-color: rgba(180, 180, 180, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s ease;
            z-index: 2;
        }

        .help-button:hover {
            background-color: rgba(150, 150, 150, 0.9);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 10;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
        }

        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 25px; /* PC 패딩 조정 */
            border: 1px solid #888;
            border-radius: 15px;
            width: 80%;
            max-width: 500px;
            text-align: center;
            position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            box-sizing: border-box;
        }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            top: 10px;
            right: 20px;
        }

        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        #restaurantInput {
            width: calc(100% - 20px);
            padding: 10px;
            margin-bottom: 15px; /* 마진 조정 */
            border: 2px solid rgb(190, 214, 0);
            border-radius: 8px;
            font-size: 1em;
            height: 80px;
            resize: vertical;
            box-sizing: border-box;
        }

        #addRestaurantToList {
            margin-top: 5px; /* 마진 조정 */
        }

        #restaurantListEdit {
            list-style-type: none;
            padding: 0;
            max-height: 300px;
            overflow-y: auto;
            text-align: left;
        }

        #restaurantListEdit li {
            background-color: #f0f0f0;
            margin-bottom: 8px; /* 마진 조정 */
            padding: 8px 12px; /* 패딩 조정 */
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.1em;
            flex-wrap: nowrap;
        }

        #restaurantListEdit li span {
            flex-grow: 1;
            margin-right: 10px;
            word-break: break-all;
            overflow-wrap: break-word;
        }

        .help-modal-content {
            padding: 20px; /* 패딩 조정 */
            text-align: left;
        }

        .help-modal-content h2 {
            font-size: 1.8em;
            color: #333;
            margin-bottom: 15px; /* 마진 조정 */
            text-align: center;
        }

        .help-modal-content p {
            font-size: 1.1em;
            line-height: 1.6;
            margin-bottom: 10px; /* 마진 조정 */
            color: #555;
        }

        .help-modal-content p .emoji {
            margin-right: 8px;
            font-size: 1.2em;
        }

        /* Footer Styles */
        .footer {
            width: 100%;
            padding: 15px 0;
            text-align: center;
            color: #777;
            font-size: 0.9em;
            flex-shrink: 0;
            margin-top: 20px; /* 룰렛 컨테이너 바로 아래에 오도록 마진 추가 */
        }

        /* --- 미디어 쿼리: 작은 화면 (모바일)에 대한 최적화 --- */
        @media (max-width: 600px) {
            .container {
                padding: 1.2em 0.8em; /* 모바일 패딩 더 줄임 */
                width: 95%;
                margin-top: 0; /* 중앙 정렬을 위해 마진 제거 */
                margin-bottom: 0; /* 중앙 정렬을 위해 마진 제거 */
            }

            .title {
                font-size: 1.7em; /* 모바일 폰트 크기 조정 */
                margin-bottom: 0.8em; /* 모바일 마진 조정 */
            }
            .title .emoji {
                font-size: 0.9em; /* 모바일 이모지 크기 조정 */
                margin: 0 0.2em;
            }

            .help-button {
                top: 8px; /* 모바일 위치 조정 */
                left: 8px; /* 모바일 위치 조정 */
                width: 28px; /* 모바일 크기 조정 */
                height: 28px; /* 모바일 크기 조정 */
                font-size: 0.9em; /* 모바일 폰트 크기 조정 */
            }

            .slot-machine {
                height: 70px; /* 모바일 높이 조정 */
                border-width: 3px;
                margin-bottom: 1em; /* 모바일 마진 조정 */
            }

            .slot-item {
                font-size: 1.1em; /* 모바일 폰트 크기 조정 */
                height: 70px; /* 모바일 높이 조정 */
                line-height: 70px; /* 모바일 높이 조정 */
            }

            .result-text {
                font-size: 1.1em; /* 모바일 폰트 크기 조정 */
                margin-top: 1em; /* 모바일 마진 조정 */
            }

            .btn {
                padding: 0.6em 0.8em; /* 모바일 패딩 조정 */
                font-size: 0.85em; /* 모바일 폰트 크기 조정 */
                flex-grow: 1;
            }

            .button-container {
                gap: 0.4em; /* 모바일 간격 조정 */
                margin-top: 1em; /* 모바일 마진 조정 */
            }

            .modal {
                padding: 0.8em; /* 모바일 패딩 조정 */
            }

            .modal-content {
                padding: 1.2em; /* 모바일 패딩 조정 */
                width: 90%;
            }

            .close-button {
                font-size: 1.5em; /* 모바일 폰트 크기 조정 */
                top: 0.4em; /* 모바일 위치 조정 */
                right: 0.6em; /* 모바일 위치 조정 */
            }

            #restaurantInput {
                padding: 0.5em; /* 모바일 패딩 조정 */
                margin-bottom: 0.8em; /* 모바일 마진 조정 */
                height: 4.5em; /* 모바일 높이 조정 */
            }

            #restaurantListEdit {
                max-height: 35vh; /* 모바일 높이 조정 */
            }

            #restaurantListEdit li {
                margin-bottom: 0.6em; /* 모바일 마진 조정 */
                padding: 0.6em 0.8em; /* 모바일 패딩 조정 */
            }

            #restaurantListEdit li span {
                margin-right: 0.4em; /* 모바일 간격 조정 */
            }

            #restaurantListEdit li .edit-btn,
            #restaurantListEdit li .delete-btn {
                font-size: 0.75em; /* 모바일 폰트 크기 조정 */
                padding: 0.3em 0.6em; /* 모바일 패딩 조정 */
            }

            #restaurantListEdit li .edit-input {
                width: calc(100% - 90px); /* 모바일 버튼 너비 고려 */
                padding: 0.3em; /* 모바일 패딩 조정 */
            }
            .help-modal-content h2 {
                font-size: 1.4em; /* 모바일 폰트 크기 조정 */
            }

            .help-modal-content p {
                font-size: 0.95em; /* 모바일 폰트 크기 조정 */
            }

            .footer {
                margin-top: 15px; /* 모바일에서도 룰렛 컨테이너 바로 아래에 오도록 마진 조정 */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <button class="help-button" id="helpButton">?</button>
        <h1 class="title">
            <span class="emoji">✈️</span>
            오늘의 점심
            <span class="emoji">✈️</span>
        </h1>

        <div class="slot-machine">
            <div class="slot-content-wrapper"></div>
        </div>

        <p class="result-text"></p>

        <div class="button-container">
            <button id="spinButton" class="btn">돌리기</button>
            <button id="addButton" class="btn">추가하기</button>
            <button id="editButton" class="btn">목록편집</button>
        </div>
    </div>
    
    <footer class="footer">
        <p>&copy; 2025 인사전략팀 인턴 한세진</p>
    </footer>

    <div id="addModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>식당 추가하기</h2>
            <textarea id="restaurantInput" placeholder="식당 이름을 콤마(,) 또는 줄 띄움으로 구분하여 입력하세요!"></textarea>
            <button id="addRestaurantToList" class="btn">추가</button>
        </div>
    </div>

    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>식당 목록 편집</h2>
            <ul id="restaurantListEdit"></ul>
        </div>
    </div>

    <div id="helpModal" class="modal">
        <div class="modal-content help-modal-content">
            <span class="close-button">&times;</span>
            <h2>오늘의 점심 룰렛 🍽️</h2>
            <p><span class="emoji">🤔</span> 뭘 먹을지 고민될 때, '돌리기' 버튼을 눌러 점심 식당을 정해보세요!</p>
            <p><span class="emoji">➕</span> 새로운 식당을 추가하고 싶다면 '추가하기' 버튼을 눌러 목록에 추가할 수 있어요!</p>
            <p><span class="emoji">✏️</span> 기존 식당 목록을 수정하거나 삭제하고 싶다면 '목록 편집' 버튼을 활용하세요!</p>
            <p><span class="emoji">✨</span> 모든 식당의 당첨 확률은 동일합니다!</p>
            <p><span class="emoji">🔄</span> 앱 업데이트 내용을 반영하고 싶다면 쿠키/사이트 데이터를 삭제해보세요!</p>
            <p><span class="emoji">❗</span> 단, 쿠키/사이트 데이터를 삭제하면 저장된 사용자 설정이 초기화될 수 있습니다!</p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const slotMachine = document.querySelector('.slot-machine');
            const slotContentWrapper = document.querySelector('.slot-content-wrapper');
            const resultText = document.querySelector('.result-text');
            const spinButton = document.getElementById('spinButton');
            const addButton = document.getElementById('addButton');
            const editButton = document.getElementById('editButton');
            const helpButton = document.getElementById('helpButton');

            const addModal = document.getElementById('addModal');
            const editModal = document.getElementById('editModal');
            const helpModal = document.getElementById('helpModal');
            const closeButtons = document.querySelectorAll('.close-button');
            const restaurantInput = document.getElementById('restaurantInput');
            const addRestaurantToListButton = document.getElementById('addRestaurantToList');
            const restaurantListEdit = document.getElementById('restaurantListEdit');

            let restaurants = [];
            let itemHeight = 0;
            let isSpinning = false;

            const defaultRestaurants = [
                '샐모닝', '센몬텐', '제이그램', '초애삼계탕', '하우슬리', '헤리스헤이스', '여가반상', 
                '스타벅스', '베어스타코', '파리바게뜨', '코코의 식탁', '오국밥', '보영만두', '한소쿰', 
                '오지오커피', '소풍가는날', '나이스카페인클럽', '저스트샐러드', '올라포케', '찌미오', 
                '커피사피엔스', '월수금', '꽈리칼국수', '본도시락', '계단라멘', '신의한국수', '훅트포케', 
                '육채미', '영미당 닭갈비', '엄마손뷔페', '돈태백', '마곡회관', '힐 베이글', '앤덴커피', 
                '대가원', '명동칼국수', '중식당 청가', '화월', '홍콩반점', '카페디얼', '이자카야 하루', 
                '마곡동소담김밥', '고릴라쉐프', 'SO GON', '로스터리락온', '민영활어공장', '조선부뚜막', 
                '울동네뚜부집', '어달스시', '부대옥', '순대실록', '스타벅스', '오모이', '설반', '사위식당', 
                '진마루', '짬뽕지존', '버거킹', '헤비스테이크', '미숯랭', '샐러디', '초이다이닝', 
                '란콰이펑누들', '시도니아', '후라토식당', '당산포차 점심뷔페', '콜트클럽', '본죽&비빔밥cafe', 
                '컴포즈커피', '샐러디', '종로계림닭도리탕원조', '박가부대', '전주현대옥'
            ];

            function loadRestaurants() {
                const storedRestaurants = localStorage.getItem('restaurants');
                if (storedRestaurants) {
                    restaurants = JSON.parse(storedRestaurants);
                } else {
                    restaurants = [...defaultRestaurants];
                    saveRestaurants();
                }
                renderSlotItems();
            }

            function saveRestaurants() {
                localStorage.setItem('restaurants', JSON.stringify(restaurants));
            }

            function renderSlotItems() {
                slotContentWrapper.innerHTML = '';

                if (restaurants.length === 0) {
                    const defaultItem = document.createElement('div');
                    defaultItem.classList.add('slot-item');
                    defaultItem.textContent = '식당을 추가해주세요!';
                    slotContentWrapper.appendChild(defaultItem);
                    gsap.set(slotContentWrapper, { y: 0 });
                    itemHeight = defaultItem.offsetHeight;
                    return;
                }

                const repeatCount = 10;
                for (let i = 0; i < repeatCount; i++) {
                    restaurants.forEach(restaurant => {
                        const div = document.createElement('div');
                        div.classList.add('slot-item');
                        div.textContent = restaurant;
                        slotContentWrapper.appendChild(div);
                    });
                }

                itemHeight = slotContentWrapper.querySelector('.slot-item').offsetHeight;
                gsap.set(slotContentWrapper, { y: 0 });
            }

            spinButton.addEventListener('click', () => {
                if (restaurants.length === 0) {
                    alert('식당 목록이 비어있습니다. 식당을 추가해주세요!');
                    return;
                }
                if (isSpinning) {
                    return;
                }

                isSpinning = true;
                spinButton.disabled = true;
                resultText.innerHTML = '';

                gsap.killTweensOf(slotContentWrapper);
                gsap.set(slotContentWrapper, { y: 0 });

                const totalOriginalItems = restaurants.length;
                const selectedOriginalIndex = Math.floor(Math.random() * totalOriginalItems);

                const revolutions = 5;
                const finalTargetIndex = (revolutions * totalOriginalItems) + selectedOriginalIndex;

                const targetY = -finalTargetIndex * itemHeight;

                gsap.to(slotContentWrapper, {
                    y: targetY,
                    duration: 5,
                    ease: "power4.out",
                    overwrite: "auto",
                    onComplete: () => {
                        const currentY = gsap.getProperty(slotContentWrapper, "y");
                        const stoppedItemIndex = Math.round(Math.abs(currentY) / itemHeight);
                        const actualSelectedRestaurantIndex = stoppedItemIndex % totalOriginalItems;
                        const actualSelectedRestaurant = restaurants[actualSelectedRestaurantIndex];

                        resultText.innerHTML = `오늘은 <span class="result-restaurant-name">${actualSelectedRestaurant}</span>에서 먹어요!`;
                        spinButton.disabled = false;
                        isSpinning = false;

                        gsap.set(slotContentWrapper, { y: -(revolutions * totalOriginalItems + selectedOriginalIndex) * itemHeight });
                    }
                });
            });

            addRestaurantToListButton.addEventListener('click', () => {
                const inputText = restaurantInput.value.trim();
                if (inputText) {
                    const newRestaurants = inputText.split(/[\n,]+/).map(item => item.trim()).filter(item => item.length > 0);
                    let addedCount = 0;

                    newRestaurants.forEach(newRestaurant => {
                        if (newRestaurant && !restaurants.includes(newRestaurant)) {
                            restaurants.push(newRestaurant);
                            addedCount++;
                        }
                    });

                    if (addedCount > 0) {
                        saveRestaurants();
                        renderSlotItems();
                        alert(`${addedCount}개의 식당이 목록에 추가되었습니다!`);
                        addModal.style.display = 'none';
                    } else if (newRestaurants.length > 0) {
                        alert('이미 존재하는 식당이거나 유효하지 않은 입력입니다.');
                    } else {
                        alert('식당 이름을 입력해주세요.');
                    }
                } else {
                    alert('식당 이름을 입력해주세요.');
                }
            });

            addButton.addEventListener('click', () => {
                addModal.style.display = 'flex';
                restaurantInput.value = '';
                restaurantInput.focus();
            });

            editButton.addEventListener('click', () => {
                renderEditList();
                editModal.style.display = 'flex';
            });

            helpButton.addEventListener('click', () => {
                helpModal.style.display = 'flex';
            });

            function renderEditList() {
                restaurantListEdit.innerHTML = '';
                if (restaurants.length === 0) {
                    restaurantListEdit.innerHTML = '<li>등록된 식당이 없습니다.</li>';
                    return;
                }
                restaurants.forEach((restaurant, index) => {
                    const listItem = document.createElement('li');
                    const span = document.createElement('span');
                    span.textContent = restaurant;
                    listItem.appendChild(span);

                    const buttonWrapper = document.createElement('div');
                    buttonWrapper.classList.add('button-wrapper');

                    const editButton = document.createElement('button');
                    editButton.classList.add('edit-btn');
                    editButton.textContent = '수정';
                    editButton.dataset.index = index;
                    buttonWrapper.appendChild(editButton);

                    const deleteButton = document.createElement('button');
                    deleteButton.classList.add('delete-btn');
                    deleteButton.textContent = '삭제';
                    deleteButton.dataset.index = index;
                    buttonWrapper.appendChild(deleteButton);

                    listItem.appendChild(buttonWrapper);
                    restaurantListEdit.appendChild(listItem);
                });

                document.querySelectorAll('.edit-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const indexToEdit = parseInt(e.target.dataset.index);
                        const listItem = e.target.closest('li');
                        const restaurantSpan = listItem.querySelector('span');
                        const originalName = restaurantSpan.textContent;

                        const inputField = document.createElement('input');
                        inputField.type = 'text';
                        inputField.classList.add('edit-input');
                        inputField.value = originalName;

                        listItem.replaceChild(inputField, restaurantSpan);
                        inputField.focus();

                        const saveChanges = () => {
                            const newName = inputField.value.trim();
                            if (newName && newName !== originalName) {
                                if (!restaurants.includes(newName)) {
                                    restaurants[indexToEdit] = newName;
                                    saveRestaurants();
                                    renderEditList();
                                    renderSlotItems();
                                } else {
                                    alert('이미 존재하는 이름입니다. 다른 이름을 입력해주세요.');
                                    const tempSpan = document.createElement('span');
                                    tempSpan.textContent = originalName;
                                    listItem.replaceChild(tempSpan, inputField);
                                }
                            } else {
                                const tempSpan = document.createElement('span');
                                tempSpan.textContent = originalName;
                                listItem.replaceChild(tempSpan, inputField);
                            }
                        };

                        inputField.addEventListener('keypress', (event) => {
                            if (event.key === 'Enter') {
                                saveChanges();
                            }
                        });

                        inputField.addEventListener('blur', () => {
                            saveChanges();
                        });
                    });
                });

                document.querySelectorAll('.delete-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const indexToDelete = parseInt(e.target.dataset.index);
                        const deletedRestaurant = restaurants[indexToDelete];
                        if (confirm(`${deletedRestaurant}을(를) 정말 삭제하시겠습니까?`)) {
                            restaurants.splice(indexToDelete, 1);
                            saveRestaurants();
                            renderEditList();
                            renderSlotItems();
                        }
                    });
                });
            }

            closeButtons.forEach(button => {
                button.addEventListener('click', () => {
                    addModal.style.display = 'none';
                    editModal.style.display = 'none';
                    helpModal.style.display = 'none';
                });
            });

            window.addEventListener('click', (event) => {
                if (event.target === addModal) {
                    addModal.style.display = 'none';
                }
                if (event.target === editModal) {
                    editModal.style.display = 'none';
                }
                if (event.target === helpModal) {
                    helpModal.style.display = 'none';
                }
            });

            loadRestaurants();
            window.addEventListener('load', () => {
                if (slotContentWrapper.querySelector('.slot-item')) {
                    itemHeight = slotContentWrapper.querySelector('.slot-item').offsetHeight;
                }
            });
        });
    </script>
</body>
</html>
